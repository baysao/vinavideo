TinyCore.Module.define("models_vidtop",[],function(){function a(t){for(var e=[],r=t[0],n=1;n<t.length;n++){for(var i,o={},a=t[n],c=0;c<r.length;c++)i=a[c],objectPath.set(o,r[c],i);e.push(o)}return e}function t(t,r){var e={delimiter:"",newline:"",quoteChar:'"',header:!1,dynamicTyping:!0,preview:0,encoding:"",worker:!1,comments:!1,skipEmptyLines:!1,chunk:void 0,fastMode:void 0,beforeFirstChunk:void 0,withCredentials:void 0,step:void 0,complete:n,error:i,download:!0};function n(t){o();var e=a(t.data);r(e)}function i(t,e){o()}function o(){return void 0!==window.performance?window.performance.now():0}o(),Papa.parse(t,e)}var p=lru(100),c=function(t,e){var r=Object.prototype.toString.call(t);if(r!==Object.prototype.toString.call(e))return!1;if(["[object Array]","[object Object]"].indexOf(r)<0)return!1;var n="[object Array]"===r?t.length:Object.keys(t).length;if(n!==("[object Array]"===r?e.length:Object.keys(e).length))return!1;function i(t,e){var r=Object.prototype.toString.call(t);if(0<=["[object Array]","[object Object]"].indexOf(r)){if(!c(t,e))return!1}else{if(r!==Object.prototype.toString.call(e))return!1;if("[object Function]"===r){if(t.toString()!==e.toString())return!1}else if(t!==e)return!1}}if("[object Array]"===r){for(var o=0;o<n;o++)if(!1===i(t[o],e[o]))return!1}else for(var a in t)if(t.hasOwnProperty(a)&&!1===i(t[a],e[a]))return!1;return!0};return $LAB.script("http://rawgit.com/kidh0/jquery.idle/master/vanilla.idle.min.js").wait(function(){window.idle({onIdle:function(){for(var r=p.last;r;){t("https://docs.google.com/spreadsheets/d/e/"+r+"/pub?output=csv",function(t){var e=p.get(r);t&&!c(t,e)&&(vidtop.config&&vidtop.config.player&&r==vidtop.config.player?p.set(r,JSON.stringify(t)):p.set(r,t))}),r=p.cache[r].next}},idle:3e4,keepTracking:!0}).start()}),{onStart:function(t){},getCache:function(){return p},getDataItem:function(t,e){var r=t+"."+e.id;return e.post={ID:r},e.href="#p/"+r,e.link="#p/"+r,e.content=e.text,e.post_id=r,e},getDataList:function(e,r){var n=this;n.getData(e,function(t){r(t.filter(function(t){return t}).map(function(t){return n.getDataItem(e,t)}))})},getPlayObj:function(t,e){var r=this;r.getData(t,function(t){r.getDataPlayDetail(t,e)})},getDataPlayDetail:function(e,r){e.player||(e.player=vidtop.config.player),this.getData(e.player,function(t){!function(t,e,r){var n=e.constructor===Array?e[0]:e;Object.assign(n.meta,{title:t.title,subTitle:t.subTitle}),n.preview={previewSeconds:"0",previewLink:"",previewTitle:"",previewDescription:""},n.options.type=t.src_type,n.options.code=t.src_play,r(n)}(e,t,r)})},_getDataHandler:function(t,e,r,n){var i=t.filter(function(t){return t.status});n(r?i.filter(function(t){return t.id==r})[0]:i)},getData:function(e,r){var n,i,o=this;if(/\./.test(e)){var t=e.split(".");n=t[1],i=t[0]}else i=e;var a="https://docs.google.com/spreadsheets/d/e/"+(i=i.replace(/---/g,"_").replace(".html",""))+"/pub?output=csv",c=p.get(i);c?vidtop.config&&vidtop.config.player&&i==vidtop.config.player?o._getDataHandler(JSON.parse(c),e,n,r):o._getDataHandler(c,e,n,r):o._api(a,function(t){vidtop.config&&vidtop.config.player&&i==vidtop.config.player?p.set(i,JSON.stringify(t)):p.set(i,t),o._getDataHandler(t,e,n,r)})},_csvJSON:a,_api:t}});