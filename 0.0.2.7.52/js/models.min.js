TinyCore.Module.define("models_vidtop",[],function(){function l(t){for(var e=[],n=t[0],o=1;o<t.length;o++){for(var r,i={},a=t[o],c=0;c<n.length;c++)r=a[c],objectPath.set(i,n[c],r);e.push(i)}return e}function t(t,n){var o,e={delimiter:"",newline:"",quoteChar:'"',header:!1,dynamicTyping:!0,preview:0,encoding:"",worker:!1,comments:!1,skipEmptyLines:!1,chunk:void 0,fastMode:void 0,beforeFirstChunk:void 0,withCredentials:void 0,step:void 0,complete:i,error:a,download:!0},r=c();function i(t){o=c(),function(t){t&&console.log(t),console.log("       Time:",o-r||"(Unknown; your browser does not support the Performance API)","ms")}("Parse complete");var e=l(t.data);n(e)}function a(t,e){o=c(),console.log("ERROR:",t,e)}function c(){return void 0!==window.performance?window.performance.now():0}Papa.parse(t,e)}var s=lru(100),c=function(t,e){var n=Object.prototype.toString.call(t);if(n!==Object.prototype.toString.call(e))return!1;if(["[object Array]","[object Object]"].indexOf(n)<0)return!1;var o="[object Array]"===n?t.length:Object.keys(t).length;if(o!==("[object Array]"===n?e.length:Object.keys(e).length))return!1;function r(t,e){var n=Object.prototype.toString.call(t);if(0<=["[object Array]","[object Object]"].indexOf(n)){if(!c(t,e))return!1}else{if(n!==Object.prototype.toString.call(e))return!1;if("[object Function]"===n){if(t.toString()!==e.toString())return!1}else if(t!==e)return!1}}if("[object Array]"===n){for(var i=0;i<o;i++)if(!1===r(t[i],e[i]))return!1}else for(var a in t)if(t.hasOwnProperty(a)&&!1===r(t[a],e[a]))return!1;return!0};return $LAB.script(vidtop.base_url+"js/vanilla.idle.min.js").wait(function(){window.idle({onIdle:function(){console.log("idle"),console.log(s.length);var n=s.last;for(console.log(n);n;){console.log(n),t("./data/"+n+".csv",function(t){var e=s.get(n);t&&!c(t,e)&&(console.log("key1:"+n),console.log(JSON.stringify(t)),vidtop.config&&vidtop.config.player&&n==vidtop.config.player?s.set(n,JSON.stringify(t)):s.set(n,t),console.log(s.length))}),n=s.cache[n].next}},idle:3e4,keepTracking:!0}).start()}),{onStart:function(t){},getCache:function(){return s},getDataItem:function(t,e){var n=t+"."+e.id;return e.post={ID:n},e.href="#p/"+n,e.link="#p/"+n,e.content=e.text,e.post_id=n,e},getDataList:function(e,n){var o=this;o.getData(e,function(t){n(t.filter(function(t){return t}).map(function(t){return o.getDataItem(e,t)}))})},getPlayObj:function(t,e){var n=this;n.getData(t,function(t){n.getDataPlayDetail(t,e)})},getDataPlayDetail:function(e,n){e.player||(e.player=vidtop.config.player),this.getData(e.player,function(t){!function(t,e,n){var o=e.constructor===Array?e[0]:e;Object.assign(o.meta,{title:t.title,subTitle:t.subTitle}),o.preview={previewSeconds:"0",previewLink:"",previewTitle:"",previewDescription:""},o.options.type=t.src_type,o.options.code=t.src_play,n(o)}(e,t,n)})},_getDataHandler:function(t,e,n,o){var r=t.filter(function(t){return t.status});o(n?r.filter(function(t){return t.id==n})[0]:r)},getData:function(e,n){var o,r,i=this;if(/\./.test(e)){var t=e.split(".");o=t[1],r=t[0]}else r=e;var a="./data/"+(r=r.replace(/---/g,"_").replace(".html",""))+".csv",c=s.get(r);c?vidtop.config&&vidtop.config.player&&r==vidtop.config.player?i._getDataHandler(JSON.parse(c),e,o,n):i._getDataHandler(c,e,o,n):i._api(a,function(t){console.log("key1:"+r),console.log(JSON.stringify(t)),vidtop.config&&vidtop.config.player&&r==vidtop.config.player?s.set(r,JSON.stringify(t)):s.set(r,t),console.log(s.length),i._getDataHandler(t,e,o,n)})},_csvJSON:l,_api:t}});
